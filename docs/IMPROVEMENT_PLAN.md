# 개선 계획서

## 우선순위 기준
- **P0 (Critical)**: 핵심 기능 동작 문제, 사용자 경험에 큰 영향
- **P1 (High)**: 주요 기능 개선, 사용성 향상
- **P2 (Medium)**: UI/UX 개선, 편의성 향상
- **P3 (Low)**: 사소한 개선, 정리 작업

---

## 중요 수정 사항

### ✅ P0-1: 모니터링 수집이 다른 페이지에서도 계속되어야 하는데 중단되는 문제 [완료]
**현상**: 다른 페이지로 이동 시 수집은 계속되지만 자원사용률과 이력 저장이 안됨. 콘솔이 멈춤.
**원인 분석**:
- 백그라운드 수집은 계속되고 있지만, 페이지 전환 시 데이터 업데이트가 안됨
- WebSocket 연결이 페이지 전환 시 끊기거나 재연결이 안됨
- `onCollectionComplete` 콜백이 다른 페이지에서는 등록되지 않음
**해결 완료**:
- ✅ `base.js`의 `ResourceUsageCollector`가 모든 페이지에서 초기화되도록 보장
- ✅ 페이지 전환 시에도 WebSocket 연결 유지 및 자동 재연결 구현
- ✅ 수집 완료 시 전역 상태 업데이트 및 localStorage 동기화
- ✅ 콘솔 로그 최적화 (디버그 모드로 제어, 불필요한 로그 제거)
- ✅ 마지막 수집 시간을 네비바에 표시 (P2-1도 함께 완료)

### ✅ P0-2: 회선 인터페이스 실시간 그래프에 표시 안됨 [완료 + 개선]
**현상**: 인터페이스 데이터는 수집되지만 실시간 그래프에 표시되지 않음
**원인**: 
- 인터페이스 차트가 기본적으로 접혀있어서 보이지 않음
- 설정에 등록된 인터페이스가 항상 표시되지 않음
**해결 완료**:
- ✅ 인터페이스 차트를 기본적으로 펼쳐진 상태로 변경
- ✅ 인터페이스 메트릭 차트가 자동으로 표시되도록 수정
- ✅ **개선**: 설정에 등록된 인터페이스는 데이터 유무와 관계없이 항상 차트로 표시되도록 수정
- ✅ 설정 로드 후 차트 DOM 초기화하도록 변경하여 등록된 인터페이스 모두 표시

### ✅ P1-3: 회선 인터페이스 히트맵에서 in/out 값을 동시에 출력 [완료]
**현상**: 현재는 in/out이 별도 컬럼으로 표시됨
**요구사항**: 하나의 셀에 in/out 값을 동시에 표시 (예: "10.5 / 8.2 Mbps")
**해결 완료**:
- ✅ 히트맵 데이터 포맷 변경: in/out을 하나의 메트릭으로 통합
- ✅ `dataLabels.formatter`에서 in/out 값을 함께 표시 (예: "10.5/8.2M")
- ✅ tooltip에서도 in/out 값 함께 표시 (예: "IN: 10.50 Mbps / OUT: 8.20 Mbps")

### ✅ P1-4: 히트맵 x,y 레이블 표시 개선 [완료]
**현상**: 레이블이 고정되어 있지 않음
**해결 완료**:
- ✅ ApexCharts 옵션에서 `hideOverlappingLabels: false` 설정 확인
- ✅ `resize()` 호출 타이밍 조정 (렌더링 후 자동 resize)
- ✅ 레이블 표시를 위한 충분한 공간 확보

### ✅ P1-5: 히트맵 한번에 보이도록 개선 [완료]
**요구사항**:
- 표시할 항목이 많으면 숫자 생략, 호버 시 표시
- 임계치 정보에 따라 색상으로만 구분
- 호버 시 x축 레이블은 표시되지만 y축 레이블을 알 수 없음 → y축 레이블도 tooltip에 표시
**해결 완료**:
- ✅ `dataLabels.enabled`를 동적으로 제어 (데이터가 많으면 false, rowCount > 20 또는 xCategories > 10)
- ✅ tooltip에 y축 레이블 정보 추가 (호스트명과 메트릭명 함께 표시)
- ✅ 색상 구분 강화 (임계치 기반 색상 스케일 유지)

### ✅ P1-6: 세션브라우저에서 세션분석 기능을 필요시에만 하도록 변경 [완료 + 개선]
**현상**: 현재는 자동으로 분석을 수행
**요구사항**: 통계분석 버튼을 추가하여 필요시에만 분석 수행
**해결 완료**:
- ✅ `session_browser.js`에서 자동 분석 제거 (`loadLatest` 함수에서 자동 호출 제거)
- ✅ "통계 분석" 버튼 추가 (세션 불러오기 버튼 옆에 배치)
- ✅ 버튼 클릭 시 `session_browser_analyze.js`의 분석 기능 호출
- ✅ **개선**: 통계분석 완료여부 알림 개선
  - 분석 시작 시 섹션 자동 표시
  - 완료 시 "분석 완료" 메시지 표시 (3초 후 자동 숨김)
  - 실패 시 "분석 실패" 메시지 표시 (5초 후 자동 숨김)

### ✅ P1-7: 모든 그리드에 최대 높이를 2배 정도 늘리기 [완료]
**현상**: 그리드 높이가 제한적임
**해결 완료**:
- ✅ `resource_history.html`: `max-height: 600px` → `1200px`로 변경
- ✅ `session_browser.html`: `height: 600px` → `1200px`로 변경
- ✅ `traffic_logs.html`: `height: 600px` → `1200px`로 변경

### ✅ P1-8: 인터페이스의 OID 설정과 임계치, 회선 대역폭 설정을 한번에 설정 가능하게 변경 [완료]
**현상**: 현재는 OID 설정과 임계치 설정이 분리되어 있음
**요구사항**: 하나의 폼에서 인터페이스 이름, IN/OUT OID, 임계치, 대역폭을 함께 설정
**해결 완료**:
- ✅ `settings.js`의 인터페이스 설정 UI 통합
- ✅ 하나의 행에 모든 필드 포함 (인터페이스 이름, IN OID, OUT OID, 임계치, 대역폭)
- ✅ 저장 시 모든 설정을 함께 업데이트
- ✅ API 스키마에 `interface_bandwidths` 필드 추가 (향후 인터페이스별 대역폭 지원 준비)
- ✅ 기존 설정과의 호환성 유지 (기존 데이터 자동 로드)

### ✅ P1-9: 트래픽로그 - 파일업로드 분석에서 로그파일을 파싱한 다음 그리드로 출력하고 검색가능하도록 개선 [완료]
**요구사항**:
- 로그파일 파싱 후 그리드로 출력
- 검색 가능하도록 필터링 기능 추가
- 세션브라우저와 마찬가지로 통계분석으로 구현 (자동 분석 제거)
**해결 완료**:
- ✅ API 수정: `analyze-upload` 엔드포인트가 파싱된 레코드 배열(`records`) 반환
- ✅ `traffic_logs_analyze.js` 수정: ag-grid를 사용하여 파싱된 데이터 표시
- ✅ 필터링 기능 추가: 전체 검색 및 필터 초기화 버튼
- ✅ 분석 버튼을 "통계 분석"으로 변경
- ✅ 분석 시작 시 섹션 자동 표시
- ✅ 완료 시 "분석 완료" 메시지 표시 (3초 후 자동 숨김)
- ✅ 실패 시 "분석 실패" 메시지 표시 (5초 후 자동 숨김)
- ✅ 더블클릭 시 상세 모달 표시 (traffic_logs.js의 showDetail 함수 재사용)

### ✅ P1-10: 세션 브라우저에서 값을 가져오는 동안 로딩 인디케이터 필요 [완료]
**요구사항**: 검색/필터링 시에도 로딩 인디케이터 표시
**해결 완료**:
- ✅ 로딩 인디케이터 UI 추가 (그리드 위에 오버레이 형태로 표시)
- ✅ 검색 시작 시 로딩 인디케이터 표시 (`loadGridData` 함수에서 AJAX 요청 전후 처리)
- ✅ 데이터 로드 완료 시 숨김 (AJAX 완료/실패 시 모두 숨김)
- ✅ 필터링 시에도 동일하게 적용 (`onFilterChanged` 이벤트 핸들러 추가)

---

## 사소한 수정 사항

### ✅ P2-1: 네비바에 수집중 표시 개선하고 마지막 수집시간 표시 [완료 + 개선]
**해결 완료**:
- ✅ `base.js`의 `updateNavbarIndicator` 함수 수정
- ✅ 마지막 수집 시간을 localStorage에 저장하고 표시
- ✅ WebSocket 메시지에서 수집 완료 시간 추출하여 표시
- ✅ **개선**: "몇초 전" 형식 대신 마지막 수집시각을 직접 표시 (HH:MM:SS 형식)
- ✅ **개선**: 1초마다 시간을 실시간으로 갱신하여 정확한 수집 시간 확인 가능
- ✅ 예: "수집 중 (14:23:45)" 형식으로 표시

### ✅ P2-2: 전체적으로 버튼 색상들 수정 [완료]
**요구사항**: 버튼 색상을 심플하게 통일
**해결 완료**:
- ✅ 주요 액션: `is-primary` (파란색) - 유지
- ✅ 위험한 액션: `is-danger` (빨간색) - 유지
- ✅ 보조 액션: `is-light`로 통일
  - `is-warning` → `is-light` (그래프 초기화 버튼)
  - `is-info` → `is-light` (전체 조회, 통계 분석 버튼)
  - `is-success` → `is-light` (내보내기 버튼)
  - `is-secondary` → `is-light` (엑셀 내보내기, 수정 버튼)
  - `is-link is-light` → `is-light` (일괄 등록 버튼)
- ✅ HTML 템플릿 파일들 수정 완료
- ✅ JavaScript 동적 버튼 생성 부분 수정 완료

### ✅ P2-3: 섹션 탭을 네비바 하위메뉴로 변경 [완료]
**현상**: 섹션 탭의 왼쪽 하단이 직각이고 아래 프레임은 타원이라 어색함
**요구사항**: 섹션 탭 대신 네비바에서 해당 메인메뉴의 하위메뉴로 구현
**해결 완료**:
- ✅ `base.html`의 네비바 구조 변경: 하위메뉴 드롭다운 추가
- ✅ 자원사용률 하위메뉴: 실시간 모니터링 (/resource), 이력 조회 (/resource/history)
- ✅ 트래픽 로그 하위메뉴: 원격 조회(SSH) (/traffic-logs), 파일 업로드 분석 (/traffic-logs/upload)
- ✅ 프록시 관리 하위메뉴: 프록시 목록 (/proxy), 프록시 그룹 (/proxy/groups)
- ✅ `main.py`에 새로운 URL 라우팅 추가
- ✅ 각 템플릿에서 탭 구조 제거 및 URL 기반 섹션 표시
- ✅ JavaScript 탭 전환 로직을 URL 기반으로 변경
- ✅ 레거시 URL 파라미터 지원 및 리다이렉트 처리

### ✅ P2-4: 설정 메뉴의 레이아웃 개선 [완료]
**요구사항**:
- 세션브라우저 설정과 리소스 설정 분리 불필요
- community string 레이아웃이 불필요하게 큼
- SNMP 버전은 2번으로 고정, 나중에 SNMP3 지원 준비
**해결 완료**:
- ✅ 설정 폼 통합: 탭 구조 제거하고 하나의 페이지로 통합
- ✅ community string 입력 필드 크기 조정: `field is-horizontal` 제거하고 일반 필드로 변경 (column is-3)
- ✅ SNMP 버전은 이미 v2c로 고정되어 있음 (코드 확인 완료)
- ✅ 네비바 설정 하위메뉴 제거: 단순 링크로 변경
- ✅ 통합 저장 함수 추가: `saveAllConfig()`로 모든 설정을 한 번에 저장
- ✅ 레거시 URL 파라미터 지원 및 리다이렉트 처리

### P2-5: 그리드의 필터링 기능에서 apply, cancel 기능으로 적용하도록 하고 현재 적용된 필터 수 표시
**요구사항**: 필터 변경 시 즉시 적용하지 않고 Apply 버튼으로 적용, Cancel으로 취소
**해결 방안**:
- ag-grid의 필터 상태 관리
- Apply/Cancel 버튼 추가
- 적용된 필터 수 표시

### P2-6: 세션 상세모달을 기존 한번 클릭이 아닌 더블클릭하여 모달창 열리도록 수정
**해결 방안**:
- `session_browser.js`에서 클릭 이벤트를 더블클릭으로 변경
- ag-grid의 `onRowDoubleClicked` 이벤트 사용

---

## 작업 순서 및 진행 상황

### Phase 1: Critical Issues (P0) ✅ 완료
1. ✅ P0-1: 모니터링 수집 문제 해결 [완료]
2. ✅ P0-2: 회선 인터페이스 실시간 그래프 표시 [완료]

### Phase 2: High Priority (P1) ✅ 완료 (10/10 완료)
3. ✅ P1-3: 히트맵 in/out 동시 출력 [완료]
4. ✅ P1-4: 히트맵 레이블 표시 개선 [완료]
5. ✅ P1-5: 히트맵 개선 (숫자 생략, 호버) [완료]
6. ✅ P1-6: 세션브라우저 통계분석 버튼 [완료]
7. ✅ P1-7: 그리드 높이 증가 [완료]
8. ✅ P1-8: 인터페이스 설정 통합 [완료]
9. ✅ P1-9: 트래픽로그 분석 개선 [완료]
10. ✅ P1-10: 세션 브라우저 로딩 인디케이터 [완료]

### Phase 3: Medium Priority (P2) 🔄 진행 중 (4/6 완료)
11. ✅ P2-1: 네비바 수집중 표시 개선 [완료 - P0-1과 함께 처리]
12. ✅ P2-2: 버튼 색상 통일 [완료]
13. ✅ P2-3: 섹션 탭을 네비바 하위메뉴로 변경 [완료]
14. ✅ P2-4: 설정 메뉴 레이아웃 개선 [완료]
15. ⏳ P2-5: 그리드 필터링 개선 [대기 중]
16. ⏳ P2-6: 세션 상세모달 더블클릭 [대기 중]

---

## 진행 상황 요약

### 완료된 작업 (14개)
- ✅ P0-1: 모니터링 수집 문제 해결
- ✅ P0-2: 회선 인터페이스 실시간 그래프 표시
- ✅ P1-3: 히트맵 in/out 동시 출력
- ✅ P1-4: 히트맵 레이블 표시 개선
- ✅ P1-5: 히트맵 개선 (숫자 생략, 호버)
- ✅ P1-6: 세션브라우저 통계분석 버튼
- ✅ P1-7: 그리드 높이 증가
- ✅ P1-8: 인터페이스 설정 통합
- ✅ P1-9: 트래픽로그 분석 개선
- ✅ P1-10: 세션 브라우저 로딩 인디케이터
- ✅ P2-1: 네비바 수집중 표시 개선
- ✅ P2-2: 버튼 색상 통일
- ✅ P2-3: 섹션 탭을 네비바 하위메뉴로 변경
- ✅ P2-4: 설정 메뉴 레이아웃 개선

### 남은 작업 (2개)
- ⏳ P2-3: 섹션 탭을 네비바 하위메뉴로 변경
- ⏳ P2-4: 설정 메뉴 레이아웃 개선
- ⏳ P2-5: 그리드 필터링 개선
- ⏳ P2-6: 세션 상세모달 더블클릭

### 진행률
- **Phase 1 (P0)**: 100% 완료 (2/2) + 개선 완료
- **Phase 2 (P1)**: 100% 완료 (10/10) + 개선 완료
- **Phase 3 (P2)**: 67% 완료 (4/6) + 개선 완료
- **전체 진행률**: 88% 완료 (14/16) + 미비사항 개선 완료

### 미비사항 개선 (2024년 추가)
- ✅ **P0-2 개선**: 설정에 등록된 인터페이스 항목 모두 표시 (데이터 유무와 관계없이)
- ✅ **P2-1 개선**: 네비바 수집중 표시를 마지막 수집시각으로 변경 및 실시간 갱신
- ✅ **P1-6 개선**: 통계분석 완료여부 알림 개선 (완료/실패 메시지 자동 표시)
- ✅ **수집 주기 정확성 개선**: 자원사용률 수집 주기 정확성 개선
  - 수집 시간을 고려하여 정확한 주기 유지 (수집 시간이 주기보다 길면 즉시 다음 수집 시작)
  - 다음 수집 예정 시간 계산 및 로깅 추가
  - 수집 완료 시 duration 및 next_collect_at 정보 전송
  - 회선/트래픽 데이터 수집 및 저장 로깅 강화
  - 페이지 전환과 관계없이 백그라운드 수집이 정확한 주기로 계속 실행되도록 보장

---

## 예상 작업 시간
- Phase 1: ✅ 완료 (실제 소요: 약 2시간)
- Phase 2: 🔄 진행 중 (완료: 약 6시간, 남은 작업: 약 4-6시간)
- Phase 3: ⏳ 대기 중 (예상: 4-6시간)
**총 예상 시간**: 16-24시간 (현재까지 약 8시간 소요)
