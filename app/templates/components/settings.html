{% extends "base.html" %}

{% block content %}

<!-- 프록시 목록 탭 -->
<div id="proxy-list" class="tab-panel is-active">
    <div class="box">
        <div class="level">
            <div class="level-left">
                <div class="level-item">
                    <h3 class="title is-4">프록시 서버 관리</h3>
                </div>
            </div>
            <div class="level-right">
                <div class="level-item">
                    <div class="buttons">
                        <button class="button is-primary" onclick="openModal('proxy')">프록시 추가</button>
                        <button class="button is-link is-light" onclick="openBulkProxyModal()">일괄 등록</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="table-container mt-4">
            <table class="table is-fullwidth is-hoverable">
                <thead>
                    <tr>
                        <th>호스트</th>
                        <th>그룹</th>
                        <th>상태</th>
                        <th>설명</th>
                        <th>작업</th>
                    </tr>
                </thead>
                <tbody id="proxyTableBody"></tbody>
            </table>
        </div>
    </div>
</div>

<!-- 리소스 설정 탭 -->
<div id="resource-config" class="tab-panel">
    <div class="box">
        <h3 class="title is-4">리소스 설정</h3>

        <div class="level">
            <div class="level-left">
                <div class="level-item">
                    <div class="box is-compact">
                        <div class="field is-horizontal mb-0">
                            <div class="field-label is-normal" style="min-width: 9rem;">
                                <label class="label mb-0">Community String</label>
                            </div>
                            <div class="field-body">
                                <div class="field mb-0">
                                    <div class="control">
                                        <input class="input" id="cfgCommunity" type="text" placeholder="public" value="public">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="level-right">
                <div class="level-item">
                    <div class="buttons">
                        <button class="button is-primary" onclick="saveResourceConfig()">저장</button>
                        <span id="cfgStatus" class="tag is-light ml-2">로딩 중...</span>
                    </div>
                </div>
            </div>
        </div>

        <div class="columns is-multiline">
            <div class="column is-12">
                <div class="accordion is-open">
                    <div class="accordion-header"><h4>OID 설정</h4></div>
                    <div class="accordion-body">
                        <div class="columns is-multiline">
                            <div class="column is-4">
                                <div class="field">
                                    <label class="label">cpu OID</label>
                                    <input class="input" id="cfgOidCpu" placeholder="1.3.6.1.x">
                                </div>
                            </div>
                            <div class="column is-4">
                                <div class="field">
                                    <label class="label">mem OID</label>
                                    <input class="input" id="cfgOidMem" placeholder="1.3.6.1.x">
                                </div>
                            </div>
                            <div class="column is-4">
                                <div class="field">
                                    <label class="label">cc OID</label>
                                    <input class="input" id="cfgOidCc" placeholder="1.3.6.1.x">
                                </div>
                            </div>
                            <div class="column is-4">
                                <div class="field">
                                    <label class="label">cs OID</label>
                                    <input class="input" id="cfgOidCs" placeholder="1.3.6.1.x">
                                </div>
                            </div>
                            <div class="column is-4">
                                <div class="field">
                                    <label class="label">http OID (누적)</label>
                                    <input class="input" id="cfgOidHttp" placeholder="1.3.6.1.x">
                                </div>
                            </div>
                            <div class="column is-4">
                                <div class="field">
                                    <label class="label">https OID (누적)</label>
                                    <input class="input" id="cfgOidHttps" placeholder="1.3.6.1.x">
                                </div>
                            </div>
                            <div class="column is-4">
                                <div class="field">
                                    <label class="label">ftp OID (누적)</label>
                                    <input class="input" id="cfgOidFtp" placeholder="1.3.6.1.x">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="column is-12">
                <div class="accordion is-open">
                    <div class="accordion-header"><h4>임계치 설정</h4></div>
                    <div class="accordion-body">
                        <p class="mb-3" style="color: var(--color-text-muted);">각 항목의 경고 임계치를 설정합니다. 비워두면 자동 스케일링만 사용합니다.</p>
                        <div class="columns is-multiline">
                            <div class="column is-3">
                                <div class="field">
                                    <label class="label">CPU 임계치</label>
                                    <input class="input" id="cfgThrCpu" type="number" step="1" min="0" placeholder="예: 80">
                                </div>
                            </div>
                            <div class="column is-3">
                                <div class="field">
                                    <label class="label">MEM 임계치</label>
                                    <input class="input" id="cfgThrMem" type="number" step="1" min="0" placeholder="예: 80">
                                </div>
                            </div>
                            <div class="column is-3">
                                <div class="field">
                                    <label class="label">CC 임계치</label>
                                    <input class="input" id="cfgThrCc" type="number" step="1" min="0" placeholder="숫자">
                                </div>
                            </div>
                            <div class="column is-3">
                                <div class="field">
                                    <label class="label">CS 임계치</label>
                                    <input class="input" id="cfgThrCs" type="number" step="1" min="0" placeholder="숫자">
                                </div>
                            </div>
                            <div class="column is-3">
                                <div class="field">
                                    <label class="label">HTTP Δ 임계치</label>
                                    <input class="input" id="cfgThrHttp" type="number" step="1" min="0" placeholder="초당 요청 수">
                                </div>
                            </div>
                            <div class="column is-3">
                                <div class="field">
                                    <label class="label">HTTPS Δ 임계치</label>
                                    <input class="input" id="cfgThrHttps" type="number" step="1" min="0" placeholder="초당 요청 수">
                                </div>
                            </div>
                            <div class="column is-3">
                                <div class="field">
                                    <label class="label">FTP Δ 임계치</label>
                                    <input class="input" id="cfgThrFtp" type="number" step="1" min="0" placeholder="초당 요청 수">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- 프록시 일괄 등록 모달 -->
<div class="modal" id="bulkProxyModal">
    <div class="modal-background"></div>
    <div class="modal-card">
        <header class="modal-card-head">
            <p class="modal-card-title">프록시 일괄 등록</p>
            <button class="delete" aria-label="close" onclick="closeBulkProxyModal()"></button>
        </header>
        <section class="modal-card-body">
            <div class="content">
                <p>아래 형식으로 한 줄에 하나씩 입력하세요:</p>
                <pre><code>host,username,password[,group_name][,traffic_log_path][,is_active(true|false)][,description]</code></pre>
                <p class="is-size-7" style="color: var(--color-text-muted);">그룹명이 존재하지 않으면 해당 행은 오류로 처리됩니다.</p>
            </div>
            <div class="field">
                <label class="label">CSV 입력</label>
                <div class="control">
                    <textarea class="textarea" id="bulkProxyInput" placeholder="ex)
proxy-01.local,admin,pass123,서울센터,/var/log/proxy/traffic.log,true,서울센터 1호기
10.0.0.5,root,Secret!,,,,false,임시 서버" rows="10"></textarea>
                </div>
                <p class="help">빈 값은 생략하거나 비워둘 수 있습니다. 공백만 있는 값은 무시됩니다.</p>
            </div>
        </section>
        <footer class="modal-card-foot">
            <button class="button is-primary" onclick="submitBulkProxies()">등록</button>
            <button class="button" onclick="closeBulkProxyModal()">취소</button>
        </footer>
    </div>
    
    
</div>
<!-- 세션브라우저 설정 탭 -->
<div id="session-config" class="tab-panel">
    <div class="box">
        <div class="level">
            <div class="level-left">
                <div class="level-item">
                    <h3 class="title is-4">세션브라우저 설정</h3>
                </div>
            </div>
        </div>

        <div class="columns is-multiline">
            <div class="column is-3">
                <div class="field">
                    <label class="label">SSH 포트</label>
                    <div class="control">
                        <input class="input" id="sbCfgPort" type="number" min="1" max="65535" value="22">
                    </div>
                </div>
            </div>
            
            <div class="column is-3">
                <div class="field">
                    <label class="label">타임아웃(초)</label>
                    <div class="control">
                        <input class="input" id="sbCfgTimeout" type="number" min="1" max="120" value="10">
                    </div>
                </div>
            </div>
            <div class="column is-4">
                <div class="field">
                    <label class="label">호스트키 정책</label>
                    <div class="control">
                        <div class="select is-fullwidth">
                            <select id="sbCfgHostKeyPolicy">
                                <option value="auto_add">auto_add</option>
                                <option value="reject">reject</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="level">
            <div class="level-left"></div>
            <div class="level-right">
                <div class="level-item">
                    <div class="buttons">
                        <button class="button is-primary" onclick="saveSessionConfig()">저장</button>
                        <span id="sbCfgStatus" class="tag is-light ml-2">로딩 중...</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- 프록시 그룹 탭 -->
<div id="proxy-groups" class="tab-panel">
    <div class="box">
        <div class="level">
            <div class="level-left">
                <div class="level-item">
                    <h3 class="title is-4">프록시 그룹 관리</h3>
                </div>
            </div>
            <div class="level-right">
                <div class="level-item">
                    <button class="button is-primary" onclick="openModal('group')">
                        그룹 추가
                    </button>
                </div>
            </div>
        </div>

        <div class="table-container mt-4">
            <table class="table is-fullwidth is-hoverable">
                <thead>
                    <tr>
                        <th>그룹명</th>
                        <th>설명</th>
                        <th>프록시 수</th>
                        <th>작업</th>
                    </tr>
                </thead>
                <tbody id="groupTableBody"></tbody>
            </table>
        </div>
    </div>
</div>

<!-- 프록시 추가/수정 모달 -->
<div class="modal" id="proxyModal">
    <div class="modal-background"></div>
    <div class="modal-card">
        <header class="modal-card-head">
            <p class="modal-card-title">프록시 서버</p>
            <button class="delete" aria-label="close" onclick="closeModal('proxy')"></button>
        </header>
        <section class="modal-card-body">
            <form id="proxyForm" onsubmit="return false;">
                <input type="hidden" id="proxyId">
                <div class="field">
                    <label class="label">호스트</label>
                    <div class="control">
                        <input class="input" type="text" id="host" required>
                    </div>
                </div>
                
                <div class="field">
                    <label class="label">사용자명</label>
                    <div class="control">
                        <input class="input" type="text" id="username" required>
                    </div>
                </div>
                <div class="field">
                    <label class="label">비밀번호</label>
                    <div class="control">
                        <input class="input" type="password" id="password" required>
                    </div>
                </div>
                <div class="field">
                    <label class="label">트래픽 로그 경로</label>
                    <div class="control">
                        <input class="input" type="text" id="traffic_log_path" placeholder="예: /var/log/proxy/traffic.log">
                    </div>
                    <p class="help">프록시별 실제 로그 파일의 절대 경로를 입력하세요.</p>
                </div>
                <div class="field">
                    <label class="label">그룹</label>
                    <div class="control">
                        <div class="select">
                            <select id="group_id">
                                <option value="">그룹 선택</option>
                            </select>
                        </div>
                    </div>
                </div>
                <div class="field">
                    <label class="label">설명 (선택)</label>
                    <div class="control">
                        <textarea class="textarea" id="description"></textarea>
                    </div>
                </div>
                <div class="field">
                    <label class="checkbox">
                        <input type="checkbox" id="is_active" checked>
                        활성화
                    </label>
                </div>
            </form>
        </section>
        <footer class="modal-card-foot">
            <button class="button is-primary" onclick="saveProxy()">저장</button>
            <button class="button" onclick="closeModal('proxy')">취소</button>
        </footer>
    </div>
</div>

<!-- 그룹 추가/수정 모달 -->
<div class="modal" id="groupModal">
    <div class="modal-background"></div>
    <div class="modal-card">
        <header class="modal-card-head">
            <p class="modal-card-title">프록시 그룹</p>
            <button class="delete" aria-label="close" onclick="closeModal('group')"></button>
        </header>
        <section class="modal-card-body">
            <form id="groupForm" onsubmit="return false;">
                <input type="hidden" id="groupId">
                <div class="field">
                    <label class="label">그룹명</label>
                    <div class="control">
                        <input class="input" type="text" id="groupName" required>
                    </div>
                </div>
                <div class="field">
                    <label class="label">설명</label>
                    <div class="control">
                        <textarea class="textarea" id="groupDescription"></textarea>
                    </div>
                </div>
            </form>
        </section>
        <footer class="modal-card-foot">
            <button class="button is-primary" onclick="saveGroup()">저장</button>
            <button class="button" onclick="closeModal('group')">취소</button>
        </footer>
    </div>
</div>

<script src="/static/js/settings.js?v={{ request.app.version }}"></script>
{% endblock %}
